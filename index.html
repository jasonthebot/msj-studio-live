<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>msj-studio</title>
  <style>
    :root {
      --bg: #0b0d12;
      --panel: #11141b;
      --panel-2: #171b24;
      --text: #edf1f8;
      --muted: #98a1b3;
      --accent: #7aa2ff;
      --accent-soft: #7aa2ff2e;
      --border: #252c39;
      --chip: #1a2231;
      --danger: #ff6f7f;
      --ok: #62d69f;
    }

    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color: var(--text);
      background: radial-gradient(circle at 15% -10%, #1a2335 0%, var(--bg) 44%);
      min-height: 100vh;
    }

    .layout {
      display: grid;
      grid-template-columns: minmax(920px, 1fr) 340px;
      min-height: 100vh;
    }

    .canvas-wrap { padding: 20px; }
    .canvas {
      border: 1px solid var(--border);
      border-radius: 16px;
      background: linear-gradient(180deg, #12151d, #0f1218 50%);
      min-height: calc(100vh - 40px);
      overflow: hidden;
    }

    .toolbar {
      position: sticky;
      top: 0;
      z-index: 6;
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      gap: 8px;
      padding: 12px;
      border-bottom: 1px solid var(--border);
      background: rgba(11, 13, 18, 0.93);
      backdrop-filter: blur(10px);
    }

    .group {
      display: inline-flex;
      gap: 8px;
      align-items: center;
      padding-right: 8px;
      border-right: 1px solid #1d2330;
      margin-right: 4px;
    }
    .group:last-child { border-right: 0; margin-right: 0; padding-right: 0; }

    button {
      background: var(--panel-2);
      color: var(--text);
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 8px 11px;
      cursor: pointer;
      transition: border-color .16s ease, transform .08s ease, background .18s ease;
    }
    button:hover { border-color: var(--accent); }
    button:active { transform: translateY(1px); }

    button.primary {
      background: linear-gradient(180deg, #2a3a5f, #1f2d4a);
      border-color: #395189;
    }
    button.subtle { color: var(--muted); }
    button.danger { border-color: #5d2f39; color: #ffb4be; }

    #status {
      margin-left: auto;
      color: var(--muted);
      font-size: .84rem;
      white-space: nowrap;
    }
    #status.ok { color: var(--ok); }

    #blocks {
      padding: 14px;
      display: grid;
      gap: 12px;
    }

    .block-wrap {
      position: relative;
      border-radius: 14px;
      transition: transform .12s ease;
    }

    .drag-over-top::before,
    .drag-over-bottom::after {
      content: "";
      position: absolute;
      left: 10px;
      right: 10px;
      height: 2px;
      background: var(--accent);
      box-shadow: 0 0 0 2px var(--accent-soft);
      border-radius: 3px;
      z-index: 3;
    }
    .drag-over-top::before { top: -6px; }
    .drag-over-bottom::after { bottom: -6px; }

    .block {
      background: #121722;
      border: 1px solid var(--border);
      border-radius: 14px;
      position: relative;
      overflow: hidden;
    }

    .block-head {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      border-bottom: 1px dashed #1f2532;
      padding: 8px 10px;
      background: rgba(12, 15, 21, 0.64);
      cursor: grab;
      user-select: none;
    }
    .block-head:active { cursor: grabbing; }

    .meta {
      color: var(--muted);
      font-size: .76rem;
      text-transform: uppercase;
      letter-spacing: .08em;
    }

    .drag-handle {
      font-size: .8rem;
      color: var(--muted);
      border: 1px solid #2a3241;
      border-radius: 8px;
      padding: 4px 8px;
      background: #151b27;
    }

    .content {
      padding: 18px;
      min-height: 58px;
    }

    .block.selected {
      outline: 2px solid var(--accent);
      outline-offset: 1px;
      box-shadow: 0 0 0 3px var(--accent-soft);
    }

    .editable {
      outline: none;
      border-radius: 6px;
      transition: box-shadow .15s ease;
    }
    .editable:focus {
      box-shadow: 0 0 0 2px #7aa2ff50;
    }

    .hero-title {
      font-size: clamp(1.9rem, 3.4vw, 3rem);
      line-height: 1.06;
      margin: 0 0 10px;
      max-width: 900px;
      letter-spacing: -.02em;
    }
    .hero-sub {
      color: var(--muted);
      margin: 0;
      max-width: 760px;
      font-size: 1.05rem;
    }

    .row {
      display: grid;
      grid-template-columns: repeat(3, minmax(0,1fr));
      gap: 10px;
      margin-top: 14px;
    }
    .chip {
      background: var(--chip);
      border: 1px solid var(--border);
      border-radius: 11px;
      padding: 10px;
      font-size: .92rem;
    }
    .chip .k { color: var(--muted); font-size: .8rem; margin-bottom: 4px; }

    .sidebar {
      border-left: 1px solid var(--border);
      background: #10131a;
      padding: 18px;
    }
    .section-title {
      margin: 0 0 10px;
      color: var(--muted);
      font-size: .81rem;
      text-transform: uppercase;
      letter-spacing: .09em;
    }
    .card {
      margin-bottom: 12px;
      padding: 12px;
      border: 1px solid var(--border);
      border-radius: 12px;
      background: #131823;
    }
    .field { margin-bottom: 12px; }
    label {
      display: block;
      font-size: .82rem;
      color: var(--muted);
      margin-bottom: 6px;
    }
    input, textarea {
      width: 100%;
      background: var(--panel-2);
      border: 1px solid var(--border);
      color: var(--text);
      border-radius: 10px;
      padding: 8px 10px;
      font: inherit;
    }
    .hint {
      color: var(--muted);
      font-size: .81rem;
      line-height: 1.38;
      margin: 0;
    }
    .kbd {
      border: 1px solid #36415a;
      border-radius: 7px;
      padding: 1px 6px;
      font-size: .74rem;
      color: #c6d5ff;
      background: #151c2a;
      white-space: nowrap;
    }

    @media (max-width: 1180px) {
      .layout { grid-template-columns: 1fr; }
      .sidebar { border-left: 0; border-top: 1px solid var(--border); }
      .row { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <div class="layout">
    <div class="canvas-wrap">
      <div class="canvas" id="canvas">
        <div class="toolbar">
          <div class="group">
            <button id="addHero">+ Hero</button>
            <button id="addFeatures">+ Features</button>
            <button id="addText">+ Text</button>
          </div>
          <div class="group">
            <button id="save" class="primary">Save local</button>
            <button id="duplicate" class="subtle">Duplicate</button>
            <button id="deleteBlock" class="danger">Delete</button>
          </div>
          <div class="group">
            <button id="reset" class="subtle">Reset</button>
          </div>
          <div id="status">Ready</div>
        </div>
        <div id="blocks"></div>
      </div>
    </div>

    <aside class="sidebar">
      <h3 class="section-title">msj-studio controls</h3>

      <div class="card">
        <div class="field">
          <label>Selected block background</label>
          <input type="color" id="bgColor" value="#121722" />
        </div>
        <div class="field">
          <label>Text color</label>
          <input type="color" id="textColor" value="#eef1f7" />
        </div>
        <div class="field">
          <label>Padding (px)</label>
          <input type="number" id="padding" value="18" min="0" max="120" />
        </div>
      </div>

      <div class="card">
        <p class="hint" style="margin-bottom:8px;">Desktop flow optimized: click text to edit, click block header to select, drag with handle for precise reorder.</p>
        <p class="hint" style="margin-bottom:8px;">Shortcuts: <span class="kbd">Ctrl/Cmd + S</span> save · <span class="kbd">Ctrl/Cmd + D</span> duplicate · <span class="kbd">Delete</span> remove selected</p>
        <p class="hint">Autosave runs quietly after edits. Manual save still available.</p>
      </div>
    </aside>
  </div>

<script>
  const STORE = 'msj-studio-layout-v3';
  let selectedId = null;
  let dragFromId = null;
  let autosaveTimer = null;

  const defaultBlocks = [
    {
      id: crypto.randomUUID(),
      type: 'hero',
      html: `
        <p class="editable" contenteditable="true" style="color:#9aa3b2;margin:0 0 8px;">AI Trading Infrastructure</p>
        <h2 class="hero-title editable" contenteditable="true">Build, Launch, and Scale Your Trading Stack Faster.</h2>
        <p class="hero-sub editable" contenteditable="true">Inspired by modern high-performance crypto product landing pages. Edit all text inline and use this as your live starter template.</p>
        <div class="row">
          <div class="chip editable" contenteditable="true"><div class="k">Latency</div><strong>&lt; 40ms avg execution</strong></div>
          <div class="chip editable" contenteditable="true"><div class="k">Availability</div><strong>99.9% uptime target</strong></div>
          <div class="chip editable" contenteditable="true"><div class="k">Integrations</div><strong>Exchange + wallet APIs</strong></div>
        </div>
      `,
      style: { background: '#121722', color: '#eef1f7', padding: 22 }
    },
    {
      id: crypto.randomUUID(),
      type: 'features',
      html: `
        <h3 class="editable" contenteditable="true" style="margin:0 0 10px; font-size:1.3rem;">Core Modules</h3>
        <div class="row">
          <div class="chip editable" contenteditable="true"><div class="k">Signals</div>Real-time screening, ranking, and trigger alerts.</div>
          <div class="chip editable" contenteditable="true"><div class="k">Execution</div>Rule-based entries/exits with risk controls.</div>
          <div class="chip editable" contenteditable="true"><div class="k">Analytics</div>Daily PnL, streaks, and trade breakdowns.</div>
        </div>
      `,
      style: { background: '#121722', color: '#eef1f7', padding: 20 }
    },
    {
      id: crypto.randomUUID(),
      type: 'text',
      html: '<p class="editable" contenteditable="true" style="margin:0;color:#9aa3b2;">Tip: duplicate this section style to build your full homepage fast.</p>',
      style: { background: '#121722', color: '#eef1f7', padding: 16 }
    }
  ];

  let blocks = load() || defaultBlocks;

  function load() {
    try { return JSON.parse(localStorage.getItem(STORE)); }
    catch { return null; }
  }

  function setStatus(text, kind = '') {
    const el = document.getElementById('status');
    el.textContent = text;
    el.className = kind;
  }

  function save(silent = false) {
    localStorage.setItem(STORE, JSON.stringify(blocks));
    setStatus(silent ? 'Autosaved' : 'Saved locally ✅', 'ok');
  }

  function queueAutosave() {
    clearTimeout(autosaveTimer);
    setStatus('Editing…');
    autosaveTimer = setTimeout(() => save(true), 500);
  }

  function cloneBlock(block) {
    return {
      id: crypto.randomUUID(),
      type: block.type,
      html: block.html,
      style: { ...(block.style || {}) }
    };
  }

  function render() {
    const root = document.getElementById('blocks');
    root.innerHTML = '';

    blocks.forEach((b, index) => {
      const wrap = document.createElement('div');
      wrap.className = 'block-wrap';
      wrap.dataset.id = b.id;

      const el = document.createElement('article');
      el.className = 'block' + (b.id === selectedId ? ' selected' : '');
      el.dataset.id = b.id;
      el.style.background = b.style.background;
      el.style.color = b.style.color;

      const head = document.createElement('div');
      head.className = 'block-head';
      head.draggable = true;
      head.innerHTML = `<span class="meta">${b.type} section</span><span class="drag-handle">Drag ↕</span>`;

      const content = document.createElement('div');
      content.className = 'content';
      content.style.padding = (b.style.padding || 16) + 'px';
      content.innerHTML = b.html;

      head.addEventListener('click', () => {
        selectedId = b.id;
        syncSidebar();
        render();
      });

      content.addEventListener('click', () => {
        selectedId = b.id;
        syncSidebar();
        render();
      });

      content.addEventListener('input', () => {
        b.html = content.innerHTML;
        queueAutosave();
      });

      head.addEventListener('dragstart', (e) => {
        dragFromId = b.id;
        e.dataTransfer.effectAllowed = 'move';
        e.dataTransfer.setData('text/plain', b.id);
      });

      wrap.addEventListener('dragover', (e) => {
        e.preventDefault();
        if (!dragFromId || dragFromId === b.id) return;
        const rect = wrap.getBoundingClientRect();
        const topHalf = e.clientY < rect.top + rect.height / 2;
        wrap.classList.toggle('drag-over-top', topHalf);
        wrap.classList.toggle('drag-over-bottom', !topHalf);
      });

      wrap.addEventListener('dragleave', () => {
        wrap.classList.remove('drag-over-top', 'drag-over-bottom');
      });

      wrap.addEventListener('drop', (e) => {
        e.preventDefault();
        wrap.classList.remove('drag-over-top', 'drag-over-bottom');
        const fromId = e.dataTransfer.getData('text/plain') || dragFromId;
        if (!fromId || fromId === b.id) return;

        const from = blocks.findIndex(x => x.id === fromId);
        const to = blocks.findIndex(x => x.id === b.id);
        if (from < 0 || to < 0 || from === to) return;

        const rect = wrap.getBoundingClientRect();
        const toAfter = e.clientY >= rect.top + rect.height / 2;

        const [moved] = blocks.splice(from, 1);
        let insertAt = toAfter ? to + 1 : to;
        if (from < to) insertAt -= 1;
        blocks.splice(insertAt, 0, moved);

        selectedId = moved.id;
        dragFromId = null;
        render();
        queueAutosave();
      });

      head.addEventListener('dragend', () => {
        dragFromId = null;
        document.querySelectorAll('.block-wrap').forEach(n => n.classList.remove('drag-over-top', 'drag-over-bottom'));
      });

      el.appendChild(head);
      el.appendChild(content);
      wrap.appendChild(el);
      root.appendChild(wrap);
    });

    if (!selectedId && blocks[0]) {
      selectedId = blocks[0].id;
      syncSidebar();
      render();
    }
  }

  function selected() {
    return blocks.find(b => b.id === selectedId) || null;
  }

  function syncSidebar() {
    const b = selected();
    if (!b) return;
    document.getElementById('bgColor').value = toHex(b.style.background || '#121722');
    document.getElementById('textColor').value = toHex(b.style.color || '#eef1f7');
    document.getElementById('padding').value = b.style.padding ?? 18;
  }

  function toHex(c) {
    if (!c) return '#121722';
    if (c.startsWith('#')) return c;
    const m = c.match(/\d+/g);
    if (!m) return '#121722';
    return '#' + m.slice(0,3).map(n => Number(n).toString(16).padStart(2,'0')).join('');
  }

  function addBlock(type) {
    const templates = {
      hero: {
        id: crypto.randomUUID(),
        type: 'hero',
        html: '<h2 class="hero-title editable" contenteditable="true">New Hero Section</h2><p class="hero-sub editable" contenteditable="true">Edit this text...</p>',
        style: { background: '#121722', color: '#eef1f7', padding: 22 }
      },
      features: {
        id: crypto.randomUUID(),
        type: 'features',
        html: '<h3 class="editable" contenteditable="true">Feature Grid</h3><div class="row"><div class="chip editable" contenteditable="true">Feature 1</div><div class="chip editable" contenteditable="true">Feature 2</div><div class="chip editable" contenteditable="true">Feature 3</div></div>',
        style: { background: '#121722', color: '#eef1f7', padding: 20 }
      },
      text: {
        id: crypto.randomUUID(),
        type: 'text',
        html: '<p class="editable" contenteditable="true">New text block...</p>',
        style: { background: '#121722', color: '#eef1f7', padding: 16 }
      }
    };

    blocks.push(templates[type]);
    selectedId = blocks[blocks.length - 1].id;
    render();
    queueAutosave();
  }

  document.getElementById('addHero').onclick = () => addBlock('hero');
  document.getElementById('addFeatures').onclick = () => addBlock('features');
  document.getElementById('addText').onclick = () => addBlock('text');

  document.getElementById('save').onclick = () => save(false);

  document.getElementById('duplicate').onclick = () => {
    const b = selected();
    if (!b) return;
    const i = blocks.findIndex(x => x.id === b.id);
    if (i < 0) return;
    const copy = cloneBlock(b);
    blocks.splice(i + 1, 0, copy);
    selectedId = copy.id;
    render();
    queueAutosave();
  };

  document.getElementById('reset').onclick = () => {
    if (!confirm('Reset layout to default?')) return;
    localStorage.removeItem(STORE);
    blocks = structuredClone(defaultBlocks);
    selectedId = blocks[0]?.id || null;
    render();
    save(true);
    setStatus('Reset to default', 'ok');
  };

  function deleteSelected() {
    if (!selectedId) return;
    const i = blocks.findIndex(b => b.id === selectedId);
    if (i < 0) return;
    blocks.splice(i, 1);
    selectedId = blocks[Math.max(0, i - 1)]?.id || blocks[0]?.id || null;
    render();
    queueAutosave();
  }

  document.getElementById('deleteBlock').onclick = deleteSelected;

  document.getElementById('bgColor').addEventListener('input', (e) => {
    const b = selected(); if (!b) return;
    b.style.background = e.target.value;
    const blockNode = document.querySelector(`.block[data-id="${b.id}"]`);
    if (blockNode) blockNode.style.background = b.style.background;
    queueAutosave();
  });

  document.getElementById('textColor').addEventListener('input', (e) => {
    const b = selected(); if (!b) return;
    b.style.color = e.target.value;
    const blockNode = document.querySelector(`.block[data-id="${b.id}"]`);
    if (blockNode) blockNode.style.color = b.style.color;
    queueAutosave();
  });

  document.getElementById('padding').addEventListener('input', (e) => {
    const b = selected(); if (!b) return;
    b.style.padding = Number(e.target.value || 18);
    const contentNode = document.querySelector(`.block[data-id="${b.id}"] .content`);
    if (contentNode) contentNode.style.padding = `${b.style.padding}px`;
    queueAutosave();
  });

  window.addEventListener('keydown', (e) => {
    const cmd = e.ctrlKey || e.metaKey;
    if (cmd && e.key.toLowerCase() === 's') {
      e.preventDefault();
      save(false);
    }
    if (cmd && e.key.toLowerCase() === 'd') {
      e.preventDefault();
      document.getElementById('duplicate').click();
    }
    if (!cmd && e.key === 'Delete') {
      const active = document.activeElement;
      if (active && active.classList?.contains('editable')) return;
      deleteSelected();
    }
  });

  render();
  setStatus('Ready');
</script>
</body>
</html>
